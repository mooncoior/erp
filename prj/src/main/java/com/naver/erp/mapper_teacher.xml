<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.naver.erp.AdminDAO">

<select id="getTeaListCnt" resultType="int" >
	     select
	       count(*)
         from teacher
         where 1=1
    </select> 

<select id="getTeaListCntAll" resultType="int" >
	     select
	       count(*)
	     from teacher
    </select>

<select id="getTeaList" resultType="java.util.Map" >
	    select
        tea_id           "tea_id"
        ,tea_name        "tea_name"
        ,tel_num         "tel_num"
        ,to_number(to_char(sysdate,'yyyy'))
        -
        to_number(case substr(jumin_num,7,1)
                when '1' then '19'
                when '2' then '19'
                else '20'
            end||substr(jumin_num,1,2)) 
            +1||'세' "tea_age"
        ,decode(substr(jumin_num,7,1)
          ,'1', '남','2','여','3','남','4','여') "tea_gender"   
   		,nvl(( select round((fire_date-hire_date)/365)
             from exp_matter e
            where e.tea_id = teacher.tea_id),0)   "경력"  
    from teacher
          where 1=1 
          <!-- 여유있으면 여기 검색조건 걸러낼 where 절 짜보기 . DTO도 만져야해! jsp 검색조건들 name 값 넣어야해 DTO에서-->
    </select> 
    
    <select id="getTeaDetailInfo" parameterType="com.naver.erp.AdminDTO" resultType="java.util.Map" >
	   <!--  이 mapper는 팝업 떴을 때 데이터 불러오는 구문. 팝업 다 채울수있게 해줘. 기본 베이스는 다했으니까
	    긴급 연락처, 경력에서 데이터 볼수있게 추가해줘 -->
	     select
              tea_id                                                "tea_id"
              ,tea_pwd                                                "tea_pwd"
              ,tea_name                                                "tea_name"
              ,substr(jumin_num,1,6)          					   "jumin_num1"
              ,substr(jumin_num,7)									"jumin_num2"
              ,tel_num                                             "tel_num" 
         from teacher t
         where tea_id = #{tea_id}
    </select> 

   <insert id="insertTeaInfo" parameterType="com.naver.erp.AdminDTO" >
      insert into teacher (
          		TEA_ID
          		,TEA_PWD
          		,TEA_NAME
          		,JUMIN_NUM
          		,TEL_NUM
          		,etc
      ) values( 
      		#{tea_id}
      		,#{tea_pwd}
      		,#{tea_name}
      		,#{tea_jumin_num1}||#{tea_jumin_num2}
      		,#{tea_phone}	
      		,#{tea_etc}
       	)   	
   </insert> 
   
   
   <insert id="insertTeaEmegency" parameterType="com.naver.erp.AdminDTO" >
   	 insert into TEA_EMERGENCY_INFO	(	
   				TEA_ID
   				,EMERGENCY_NAME
   				,EMERGENCY_RELATION
   				,EMERGENCY_PHONE
   		)values(
   			 #{tea_id}
 			,#{tea_emergency_name}
 			,#{tea_emergency_relation}
 			,#{tea_emergency_phone}	
   		)
   </insert>
   
      <insert id="insertExpMatter" parameterType="com.naver.erp.AdminDTO" >
   		insert into Exp_Matter(
   			EXP_NO
   			,TEA_ID
   			,COMPANY
   			,SALARY
   			,HIRE_DATE
   			,FIRE_DATE
   	)values(
   			 
         	(select nvl(max(to_number(exp_no)),0)+1 from Exp_Matter)
 			,#{tea_id}
 			,#{past_company_name}
 			,${salary}
 			,to_date('${hire_date}-01','yyyy-mm-dd')
 			,to_date('${fire_date}-01','yyyy-mm-dd')
   		)
   </insert>
   
  <delete id = "deleteTeaInfo" parameterType="com.naver.erp.AdminDTO" >
   			delete from teacher
   				where tea_id=#{tea_id}
  </delete>
   
  <delete id = "deleteTeaEmegency" parameterType="com.naver.erp.AdminDTO" >
   			delete from TEA_EMERGENCY_INFO
   				where tea_id=#{tea_id}
  </delete>
   
  <delete id = "deleteExpMatter" parameterType="com.naver.erp.AdminDTO" >
   			delete from Exp_Matter
   				where tea_id=#{tea_id}
  </delete>
   
   <!-- delete를 위한 update -->
   <update id = "updateClass_take_charge_tea" parameterType="com.naver.erp.AdminDTO" >
   			update class
   				set 
   					take_charge_tea = null
   				where 
   					take_charge_tea=#{tea_id}
  </update>  
   
 <update id="upTeaInfo" parameterType="com.naver.erp.AdminDTO">
   update 
   		teacher
   set 
   				 TEA_PWD   = #{tea_pwd}
          		,TEA_NAME  = #{tea_name}
          		,JUMIN_NUM = #{tea_jumin_num1}||#{tea_jumin_num2}
          		,TEL_NUM   = #{tea_phone}
          		,etc   	   = #{tea_etc}
   where 
   		TEA_ID=#{tea_id}	
 </update>  
   
  <update id="upTeaEmegency" parameterType="com.naver.erp.AdminDTO">
   update 
   		TEA_EMERGENCY_INFO
   set 
   				EMERGENCY_NAME		= #{tea_emergency_name}
   				,EMERGENCY_RELATION = #{tea_emergency_relation}
   				,EMERGENCY_PHONE	= #{tea_emergency_phone}
   where 
   		TEA_ID=#{tea_id}	
 </update>   
 
  <update id="upExpMatter" parameterType="com.naver.erp.AdminDTO">
   update 
   		Exp_Matter
   set 
   			TEA_ID 	   = #{tea_id}
   			,COMPANY   = #{past_company_name}
   			,SALARY    = #{salary}
   			,HIRE_DATE = #{hire_date}
   			,FIRE_DATE = #{fire_date}
where 
   		TEA_ID=#{tea_id}	
 </update>    
</mapper>
