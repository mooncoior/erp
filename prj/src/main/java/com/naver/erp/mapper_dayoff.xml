<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.naver.erp.DayOffDAO">
<sql id="dayoffWhere">
	
	 <if test="keyword1!=null and keyword1.length()>0">
        and( upper((select stu_name from student st
         where st.stu_id= d.stu_id))
         	LIKE upper('%${keyword1}%') 
   		
   		or upper(DAYOFF_KIND)
         LIKE upper('%${keyword1}%')
        
        or upper(PAYMENT_STATUS)
         LIKE upper('%${keyword1}%') )
   </if>
</sql>

<select id="getStuOffDetail" parameterType="com.naver.erp.DayOffDTO" resultType="java.util.Map" >
	   <!--  이 mapper는 팝업 떴을 때 데이터 불러오는 구문. 팝업 다 채울수있게 해줘. 기본 베이스는 다했으니까
	    긴급 연락처, 경력에서 데이터 볼수있게 추가해줘 
	    ,신청일 ,휴가 시작일, 종료일, 휴가종류, 신청자 아이디, 신청자 이름, 내용, 
	    결재상태
	    -->
select
	to_char(d.APPLICATION_DATE,'YYYY-MM-DD AM HH:MI') "APPLICATION_DATE" 
	,to_char(d.DAYOFF_START,'YYYY-MM-DD AM HH:MI') "DAYOFF_START" 
	,to_char(d.DAYOFF_END,'YYYY-MM-DD AM HH:MI') "DAYOFF_END"
	,d.DAYOFF_KIND   "DAYOFF_KIND" 
	,d.stu_id "STU_ID"                     
	,(select stu_name from student st where st.stu_id= d.stu_id) "stu_name"                     
	,d.PAYMENT_STATUS "PAYMENT_STATUS"
	,d.etc "ETC"
	from dayoff  d
	where day_id =#{DAY_ID}
 </select> 


<select id="getStuOffCnt" resultType="int" >
	     select
	       count(*)
         from dayoff
         where 1=1
         <include refid="dayoffWhere"/>
    </select> 

<select id="getStuOffCntAll" resultType="int" >
	     select
	       count(*)
	     from dayoff
</select>

<select id="getStuOff" resultType="java.util.Map" >
select
	day_id		"day_id"
	,(select stu_name from student st where st.stu_id= d.stu_id) "stu_name"                     
    ,to_char(APPLICATION_DATE,'yyyy-mm-dd')         "APPLICATION_DATE"  
    ,to_char(DAYOFF_START,'yyyy-mm-dd')             "DAYOFF_START"
    ,to_char(DAYOFF_END,'yyyy-mm-dd')               "DAYOFF_END"
    ,PAYMENT_STATUS    "PAYMENT_STATUS"                
    ,DAYOFF_KIND 	"DAYOFF_KIND"
from dayoff  d 
	where 1=1
    <include refid="dayoffWhere"/>
</select>








<insert id="insertStuOff" parameterType="com.naver.erp.DayOffDTO" >
	insert into dayoff(
			DAY_ID
			,STU_ID
			,DAYOFF_START
			,DAYOFF_END
			,DAYOFF_KIND
			,PAYMENT_STATUS
			,etc
		) values(
		 (select (nvl(max(day_id),0)+1) from dayoff)
			,#{STU_ID}
			,to_date(#{DAYOFF_START},'yyyy-mm-dd hh:mi')			
			,to_date(#{DAYOFF_END},'yyyy-mm-dd hh:mi')
			,#{DAYOFF_KIND}
			,'미결재'
			,#{ETC}
		)
</insert>

 <delete id = "deleteStuOff" parameterType="com.naver.erp.DayOffDTO" >
   			delete from dayoff
   				where day_id=#{day_id}
  </delete>

   <update id = "upStuOff" parameterType="com.naver.erp.DayOffDTO" >
	update dayoff
		set
			DAYOFF_START =to_date(#{start_date},'yyyy-mm-dd')
			,DAYOFF_END	 =to_date(#{end_date},'yyyy-mm-dd')
			,DAYOFF_KIND =#{dayoffKind}
			,ETC 		 =#{etc} 		
		where 
			day_id=#{day_id}	 
</update>

 <update id = "updateStuDayoffStatus" parameterType="com.naver.erp.DayOffDTO" >
	update dayoff
		set
			PAYMENT_STATUS = #{PAYMENT_STATUS}					
		where 
			day_id=#{day_id}	 
</update>



</mapper>
